# Project B – YOLO 객체 탐지 + GPIO 제어 (Jetson Orin)

## 1. 초기 환경 준비
- `project_B_gpio` 디렉토리 생성 후 Python venv(`.venv`) 구성.
- `opencv-python`, `torch`, `torchvision`, `ultralytics` 등을 단계적으로 설치.
- Jetson 환경은 **JetPack 5.1.1 (L4T r35.3.1)**, Python 3.8 기반.

---

## 2. Torch / Torchvision 설치 문제
- 처음에는 PyPI에서 `torch 2.0.1`이 설치되면서 **CPU 전용** 버전으로 동작 → `torch.cuda.is_available(): False`.
- Jetson에서는 반드시 **NVIDIA CUDA 빌드 wheel**을 사용해야 하므로:
  - `torch-2.0.0+nv23.05` (NVIDIA 제공 wheel)로 재설치 ✅
  - `torchvision`은 NVIDIA 빌드 wheel이 누락되어 PyPI `0.15.2` 버전을 `--no-deps`로 설치 → CUDA torch 유지.
- 최종 조합:  
  - `torch 2.0.0+nv23.05` (CUDA)  
  - `torchvision 0.15.2`  
  - `ultralytics 8.3.202`  

---

## 3. YOLOv5 → YOLOv8 전환
- YOLOv5 preview 스크립트(`yolov5_preview.py`)는 CPU에서도 정상 동작, pretrained COCO 모델 확인:
  - 클래스 80개, 예: person, bicycle, car …
  - 실제 감지 결과 `{'person': 1}` 등 출력 확인.
- 하지만 GPU 환경에서 실행 시 `torchvision.ops.nms` 의존 때문에 **C++ ops 미호출 오류(RuntimeError: Couldn't load custom C++ ops)** 발생.
- 원인: PyPI `torchvision`이 NVIDIA torch와 ABI 호환이 안 맞음.
- 해결: **YOLOv8**은 `torchvision.ops`에 의존하지 않으므로, YOLOv8으로 코드 전환 → GPU(CUDA)에서 정상 동작.

---

## 4. GPU 사용 전환
- CPU 빌드(`torch 2.0.1`) → NVIDIA CUDA 빌드(`torch 2.0.0+nv23.05`)로 교체.
- 재확인 결과:
  ```text
  torch: 2.0.0+nv23.05
  cuda available: True
  ```
- YOLOv8 실행 시 로그에:
  ```
  YOLOv8 🚀 ... torch-2.0.0+nv23.05 CUDA:0 (Orin, 6481MiB)
  ```
  → GPU에서 추론 확인.

---

## 5. GPIO 관련
- 원래 목표: 특정 클래스(person, cat, dog) 감지 시 LED/부저 제어.
- 하지만 `lgpio`/`gpiozero` 설치 시 **빌드/패키지 에러** 발생:
  - `llgpio` 라이브러리 없음 → wheel 빌드 실패.
  - apt 저장소에도 `lgpio` 패키지가 기본 제공되지 않음.
- 그래서 현재까지는 **GPIO 없이 (--gpio none)** 로 실행, 화면 감지만 정상 작동 확인.
- GPIO 제어는 `Jetson.GPIO` 모듈을 이용하는 경로(`--gpio jetson`)로 추가 준비. 실제 핀 연결 전까지는 noop 모드로 진행.

---

# ✅ 현재 상태
- YOLOv5 pretrained → 감지 확인 완료 (단, GPU NMS 충돌 문제 존재).  
- YOLOv8으로 전환 후 GPU 사용까지 정상 확인.  
- 실시간 카메라 영상 + 바운딩박스 + 라벨 + FPS 표시까지 동작.  
- GPIO는 아직 **하드웨어 제어 없이 noop 모드**로 테스트만 진행.

python ~/project_B_gpio/src/yolov8_gpio_live.py --gpio none --conf 0.5


---

## 다음 단계
- Jetson 보드에 `python3-jetson-gpio` 설치
- 핀 권한(group `gpio`) 설정
- `--gpio jetson` 모드로 LED/부저를 실제로 제어
