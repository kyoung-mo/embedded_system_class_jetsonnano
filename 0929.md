<img width="499" height="555" alt="image" src="https://github.com/user-attachments/assets/01a01e54-d957-4197-98ca-97d7b40dd798" />


<img width="428" height="466" alt="image" src="https://github.com/user-attachments/assets/5e4b08fe-b420-40f2-926a-b82c8fa53b81" />

# 오늘 오류가 떴던 이유 & 해결

- **에러:** `ModuleNotFoundError: No module named 'Jetson'`  
- **원인:** 가상환경이 **시스템 패키지(apt 경로)**를 못 봄. `python3-jetson-gpio`는 pip가 아니라 apt로 설치되므로 venv에서 기본적으로 안 보임.  
- **해결:** venv를 `--system-site-packages` 옵션으로 만들고 활성화.
```bash
python3 -m venv .venv --system-site-packages
source .venv/bin/activate
```
- **대안:** 가상환경 대신 시스템 파이썬에서 실행
```bash
sudo python3 your_script.py
```

---

# OpenCV 사용 요약

- **역할:** 카메라 캡처 → 프레임 표시 → YOLO 박스/텍스트 오버레이  
- **캡처:** `cv2.VideoCapture(0, cv2.CAP_V4L2)` 로 `/dev/video0` 열고 해상도·코덱 설정  
- **추론:** `YOLO("yolov8n.pt")`로 `model.predict(frame)` 수행  
- **렌더링:** `cv2.rectangle`, `cv2.putText`로 박스/HUD 표시 후 `cv2.imshow`  
- **루프/종료:** `cv2.waitKey(1)`로 키 입력 처리, 종료 시 `release()`/`destroyAllWindows()`
```python
import cv2
from ultralytics import YOLO

cap = cv2.VideoCapture(0, cv2.CAP_V4L2)           # 카메라 오픈
cap.set(cv2.CAP_PROP_FRAME_WIDTH, 640)
cap.set(cv2.CAP_PROP_FRAME_HEIGHT, 480)
cap.set(cv2.CAP_PROP_FOURCC, cv2.VideoWriter_fourcc(*'MJPG'))  # 장치가 지원하면 MJPG

model = YOLO("yolov8n.pt")

while True:
    ok, frame = cap.read()
    if not ok: break

    r = model.predict(source=frame, conf=0.5, verbose=False)[0]

    for b in (r.boxes or []):
        x1, y1, x2, y2 = map(int, b.xyxy[0].tolist())
        cv2.rectangle(frame, (x1,y1), (x2,y2), (0,255,0), 2)

    cv2.putText(frame, "YOLOv8 + GPIO", (10,30),
                cv2.FONT_HERSHEY_SIMPLEX, 0.8, (255,255,255), 2)

    cv2.imshow("preview", frame)
    if (cv2.waitKey(1) & 0xFF) in (27, ord('q')):
        break

cap.release()
cv2.destroyAllWindows()
```
> MJPG 경고가 거슬리면 FOURCC 설정 줄을 주석 처리해 기본 포맷(YUYV 등)으로 캡처해도 됩니다.


---

# Project B – YOLOv8 + GPIO (LED & Buzzer) 연동 요약 (v1.0)

## 1) 목표
- USB 카메라 → **YOLOv8 실시간 검출** → **객체가 하나라도 보이면** LED와 부저를 **동시에 ON 후 OFF** (펄스).
- SAFE/ALERT 모드 및 버튼 없이 **항상 동작**.

---

## 2) 배선 (BCM 기준, Jetson 40핀 헤더)
- **LED(+):** BCM **27** *(물리 13번)* → **직렬저항 220~330Ω** → LED → **GND** *(핀 6/9/14/20/25/30/34/39 중 하나)*
- **부저(+):** BCM **18** *(물리 12번)* → 부저 → **GND**
  - 패시브/액티브 모두 지원. (소리가 작다면 5V + 트랜지스터 드라이브 권장)

> 코드에서 `GPIO.setmode(GPIO.BCM)`을 사용하므로 **BCM 27/18** 기준으로 배선합니다. 실제 꽂을 때는 **헤더 물리 13/12** 핀을 사용하세요.

---

## 3) 환경 & 권한
```bash
# 프로젝트 루트
cd ~/project_B_gpio

# (권장) 가상환경: 시스템 패키지 포함 (Jetson.GPIO는 apt 경로에 설치됨)
python3 -m venv .venv --system-site-packages
source .venv/bin/activate

# Python 패키지
pip install --upgrade pip
pip install ultralytics opencv-python numpy

# Jetson.GPIO (이미 설치됨 확인)
sudo apt install -y python3-jetson-gpio
```
- **udev 규칙**은 *일반 사용자로 sudo 없이* GPIO 접근하고 싶을 때만 설정. (현재 필수 아님)

---

## 4) 단독 GPIO 테스트 (확인 완료)
- `src/gpio_test.py`: LED/부저 1초 간격으로 켜졌다 꺼짐 → 하드웨어/권한 OK.

---

## 5) 최종 운용 코드
- 파일: `src/yolov8_any_gpio_blink.py`
- 동작: 프레임마다 YOLOv8 추론 → **검출 박스가 1개 이상이면** 부저/LED를 **짧게 ON** → 자동 OFF.
- 주요 인자
  - `--pulse-ms` : ON 지속시간(ms)
  - `--cooldown-ms` : 다음 ON까지 최소 대기(ms)
  - `--pwm-freq` : (소프트톤) 부저 주파수(Hz, 패시브에 효과)
  - `--duty` : (소프트톤) 듀티(0.0~1.0)

### 실행 예시
```bash
cd ~/project_B_gpio
source .venv/bin/activate
python3 src/yolov8_any_gpio_blink.py --conf 0.5 --display 1 \
  --pulse-ms 700 --cooldown-ms 1200   # 예: ON 0.7s / OFF 1.2s
```

---

## 6) 트러블슈팅 & 해결
1) **ModuleNotFoundError: Jetson**
   - 원인: venv가 시스템 패키지 미포함
   - 해결: `python3 -m venv .venv --system-site-packages` 로 재생성

2) **Channel 18 is not a PWM**
   - 원인: Jetson.GPIO 하드웨어 PWM은 특정 핀만 허용
   - 해결: 하드웨어 PWM 대신 **소프트웨어 토글(soft tone)** 스레드 방식 적용

3) **TypeError: 'Event' object is not callable**
   - 원인: 스레드 내부 `_stop` 이름 충돌
   - 해결: `_stop_event` 로 변수명 수정 + 종료 처리 안정화

4) **Corrupt JPEG data …**
   - 원인: 일부 USB 카메라의 MJPG 스트림 경고
   - 조치: 대부분 무시 가능. 거슬리면 FOURCC 설정 주석 처리 또는 해상도/FPS 유지

5) **부저 소리 작음**
   - 원인: Jetson GPIO(3.3V, 저전류) 직결
   - 소프트웨어 개선: `--pwm-freq 2000~4000`, `--duty 0.7~0.95`, `--pulse-ms 200~300` 조절
   - **근본 해결(권장)**: **5V + NPN 트랜지스터(또는 ULN2003) 로우사이드 드라이브**
     - 배선(예: NPN 2N2222):  
       - 부저 **+ → 5V**, 부저 **− → 트랜지스터 C**, **E → GND**  
       - **GPIO18 → 1kΩ → B**, (선택) **B–GND 100kΩ 풀다운**  
       - 코일형 부저면 부저 단자에 **역병렬 다이오드(1N4148/1N5819)**

---

## 7) 현재 상태 (결론)
- **기능 기준 완료(v1.0)**: 카메라 표시 OK, YOLO 검출 OK, **검출 시 LED/부저 동시 펄스** OK, 주기 조절 OK.

---

## 8) 실행 스크립트 (옵션)
```bash
mkdir -p ~/project_B_gpio/scripts
cat > ~/project_B_gpio/scripts/run_project_b.sh <<'SH'
#!/usr/bin/env bash
set -euo pipefail
PRJ_ROOT="$(cd "$(dirname "$0")/.." && pwd)"
source "$PRJ_ROOT/.venv/bin/activate"
python3 "$PRJ_ROOT/src/yolov8_any_gpio_blink.py" --conf 0.5 --display 1 \
  --pulse-ms 700 --cooldown-ms 1200
SH
chmod +x ~/project_B_gpio/scripts/run_project_b.sh
```
- 실행: `~/project_B_gpio/scripts/run_project_b.sh`

---

## 9) 다음 단계 (선택)
- **5V 트랜지스터/ULN2003 드라이브** 적용(음량↑) 배선도
- **패턴 커스터마이즈**: 더블/트리플 비프, 클래스별 패턴/색 분기
- **부팅 자동 실행(systemd)**

---

### 메모
- 가상환경 기억하기:  
  ```bash
  python3 -m venv .venv --system-site-packages
  source .venv/bin/activate
  deactivate
  ```
